syntax = "proto3";

package file.v1;

import "file/v1/file.proto";

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

option go_package = "github.com/kitanoyoru/kgym/contracts/protobuf/gen/go/file/v1;file";

service FileService {
    rpc UploadUserAvatar(stream UploadUserAvatar.Request) returns (UploadUserAvatar.Response) {
        option (google.api.http) = {
            post: "/api/v1/files/user-avatar"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            parameters: {
                headers: {
                name: "X-Idempotency-Key";
                description: "Idempotency key";
                type: STRING,
                required: false;
                };
            };
        };
    }

    rpc GetFileURL(GetFileURL.Request) returns (GetFileURL.Response) {
        option (google.api.http) = {
            get: "/api/v1/files/{id}/url"
        };
    }

    rpc DeleteFile(DeleteFile.Request) returns (DeleteFile.Response) {
        option (google.api.http) = {
            delete: "/api/v1/files/{id}"
        };
    }
}

message UploadUserAvatar {
    message Request {
        Metadata metadata = 1;
        bytes data = 2;
    }

    message Response {
        File file = 1;
    }
}

message GetFileURL {
    message Request {
        string id = 1;
    }

    message Response {
        string url = 1;
    }
}

message DeleteFile {
    message Request {
        string id = 1;
    }

    message Response {}
}
